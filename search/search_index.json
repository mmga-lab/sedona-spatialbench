{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"SpatialBench","text":"<p>SpatialBench is a benchmark for assessing geospatial SQL analytics query performance across database systems, making it easy to run tests on a realistic dataset with any query engine.</p> <p>The methodology is unbiased, allowing you to run the benchmarks in any environment to compare the relative performance between runtimes.</p>"},{"location":"#why-spatialbench","title":"Why SpatialBench","text":"<p>SpatialBench was created because standard database benchmarks don't adequately test the unique demands of geospatial queries. SpatialBench provides an open-source, standardized, and scalable framework designed specifically for geospatial analytics.</p> <p>Inspired by the Star Schema Benchmark (SSB) and NYC taxi data, SpatialBench combines realistic urban mobility scenarios with a star schema extended with spatial attributes like pickup/dropoff points, zones, and building footprints.</p> <p>This design enables evaluation of the following geospatial operations:</p> <ul> <li>Spatial joins</li> <li>Distance queries</li> <li>Aggregations</li> <li>Point-in-polygon analysis</li> </ul> <p>Let's dive into the advantages of SpatialBench.</p>"},{"location":"#key-features","title":"Key Features","text":"<p>To ensure fair and comprehensive testing, SpatialBench provides the following advantages:</p> <ul> <li>Features realistic spatial datasets with native geometry columns.</li> <li>Includes a suite of queries that test various operations such as spatial predicates and joins.</li> <li>Provides a built-in synthetic data generator for creating consistent test data.</li> <li>Offers a configurable scale factor to benchmark performance across various   environments, from a single local machine to a large-scale cloud cluster.</li> <li>Ensures consistent and reproducible benchmark results across all environments.</li> <li>Utilizes a fully documented and unbiased methodology to facilitate fair comparisons.</li> <li>Open-source and community-driven to foster transparency and continuous improvement.</li> </ul>"},{"location":"#generate-synthetic-data","title":"Generate synthetic data","text":"<p>Here's how you can install the synthetic data generator:</p> <pre><code>cargo install --path ./spatialbench-cli\n</code></pre> <p>Here's how you can generate the synthetic dataset:</p> <pre><code>spatialbench-cli -s 1 --format=parquet\n</code></pre> <p>See the project repository README for the complete set of straightforward data generation instructions.</p>"},{"location":"#example-query","title":"Example query","text":"<p>Here's an example query that counts the number of trips that start within 500 meters of each building:</p> <pre><code>SELECT\n    b.b_buildingkey,\n    b.b_name,\n    COUNT(*) AS nearby_pickup_count\nFROM trip t\nJOIN building b\nON ST_DWithin(t.t_pickup_loc, b.b_boundary, 500)\nGROUP BY b.b_buildingkey, b.b_name\nORDER BY nearby_pickup_count DESC;\n</code></pre> <p>This query performs a distance join, followed by an aggregation. It's a great example of a query that's useful for performance benchmarking a spatial engine that can process vector geometries.</p>"},{"location":"#join-the-community","title":"Join the community","text":"<p>Feel free to start a GitHub Discussion or join the Discord community to ask the developers any questions you may have.</p> <p>We look forward to collaborating with you on these benchmarks!</p>"},{"location":"contributors-guide/","title":"Contributors Guide","text":"<p>We want to make contributing to SpatialBench as easy and transparent as possible. If you have suggestions to improve this contribution guide, feel free to open an issue in GitHub.</p>"},{"location":"contributors-guide/#our-development-process","title":"Our Development Process","text":"<p>To contribute, please find an existing issue or open a new one. Claiming the issue you are working on helps us better track progress.</p>"},{"location":"contributors-guide/#pull-requests","title":"Pull Requests","text":"<p>We actively welcome your pull requests.</p> <ol> <li>Fork the repo and create your branch from <code>main</code>.</li> <li>If you've added code that should be tested, add tests.</li> <li>If you've changed APIs, update the related documentation.</li> <li>Ensure the standard tests and conformance tests are passing.</li> <li>Ensure your code follows Rust best practices and addresses all lints from clippy.</li> <li>Open your pull request and wait for a review and approval.</li> </ol>"},{"location":"contributors-guide/#filing-issues","title":"Filing Issues","text":"<p>When opening a new issue, please follow the issue template and provide as many details as possible, including a reproducible example if applicable.</p>"},{"location":"contributors-guide/#coding-style","title":"Coding Style","text":"<p>Follow standard Rust formatting guidelines. For idiomatic code style, consult Effective Rust.</p>"},{"location":"contributors-guide/#license","title":"License","text":"<p>By contributing to SpatialBench, you agree that your contributions will be licensed under the <code>LICENSE</code> file in the root directory of this source tree.</p>"},{"location":"datasets-generators/","title":"SpatialBench Datasets and Generators","text":""},{"location":"datasets-generators/#spatialbench-datasets-and-generators","title":"SpatialBench Datasets and Generators","text":"<p>This page describes the SpatialBench datasets and shows you how to use the generators to create the spatial tables.</p> <p>SpatialBench is a geospatial benchmark designed for evaluating and optimizing spatial query performance in data systems. Inspired by the Star Schema Benchmark (SSB) and the New York City Taxi and Limousine Commission (NYC TLC) dataset, SpatialBench blends realistic urban mobility scenarios with standardized benchmarking practices.</p> <p>The benchmark adopts the familiar star schema structure from SSB, augmented with spatial attributes such as pickup and dropoff points, spatial polygon boundaries for zones, and building footprints. These spatial enhancements allow SpatialBench to effectively test geospatial operations, including spatial joins, distance-based queries, spatial aggregations, and point-in-polygon analyses.</p> <p>By combining the systematic approach of SSB with authentic, real-world scenarios drawn from NYC TLC data, SpatialBench provides meaningful and practical benchmarks relevant to urban mobility and spatial analytics workloads.</p>"},{"location":"datasets-generators/#data-model","title":"Data model","text":"<p>SpatialBench tables:</p> <ul> <li>Trip (Fact Table): Records individual trips, including spatial attributes (pickup and dropoff points), trip fare, distance, duration, and timestamps for pickup and dropoff.</li> <li>Customer: Represents customers who book trips.</li> <li>Driver: Represents drivers who fulfill trips.</li> <li>Vehicle: Details about vehicles used for trips.</li> <li>Zone: Polygon boundaries representing city areas or zones.</li> <li>Building: Polygon footprints representing building locations, types, and names.</li> </ul> Table Type Abbr. Primary Role Spatial Attributes Size per Scale Factor (SF) Building Dimension b_ Polygon footprints representing building locations Polygon footprints 20K \u00d7 (1 + log\u2082(SF)) Customer Dimension c_ Represents customers None 30K \u00d7 SF Driver Dimension s_ Represents drivers None 500 x SF Trip Fact Table t_ Records individual trips Pickup/Dropoff Points (location) 6M \u00d7 SF Vehicle Dimension v_ Details about vehicles None 100 x SF Zone Dimension z_ Polygon boundaries for city zones Polygon boundaries Tiered by SF range (see below)"},{"location":"datasets-generators/#zone-table-scaling","title":"Zone Table Scaling","text":"Scale Factor (SF) Zone Subtypes Included Zone Cardinality [0, 10) microhood, macrohood, county 156,095 [10, 100) + neighborhood 455,711 [100, 1000) + localadmin, locality, region, dependency 1,035,371 [1000+) + country 1,035,749"},{"location":"datasets-generators/#geographic-coverage","title":"Geographic Coverage","text":"<p>Spatial Bench's data generator uses continent-bounded affines. Each continent is defined by a bounding polygon, ensuring generation mostly covers land areas and introducing the natural skew of real geographies.</p> <p>Bounding polygons:</p> Region Bounding Polygon Africa <code>POLYGON ((-20.062752 -40.044425, 64.131567 -40.044425, 64.131567 37.579421, -20.062752 37.579421, -20.062752 -40.044425))</code> Europe <code>POLYGON ((-11.964479 37.926872, 64.144374 37.926872, 64.144374 71.82884, -11.964479 71.82884, -11.964479 37.926872))</code> South Asia <code>POLYGON ((64.58354 -9.709049, 145.526096 -9.709049, 145.526096 51.672557, 64.58354 51.672557, 64.58354 -9.709049))</code> North Asia <code>POLYGON ((64.495655 51.944267, 178.834704 51.944267, 178.834704 77.897255, 64.495655 77.897255, 64.495655 51.944267))</code> Oceania <code>POLYGON ((112.481901 -48.980212, 180.768942 -48.980212, 180.768942 -10.228433, 112.481901 -10.228433, 112.481901 -48.980212))</code> South America <code>POLYGON ((-83.833822 -56.170016, -33.904338 -56.170016, -33.904338 12.211188, -83.833822 12.211188, -83.833822 -56.170016))</code> South North America <code>POLYGON ((-124.890724 12.382931, -69.511192 12.382931, -69.511192 42.55308, -124.890724 42.55308, -124.890724 12.382931))</code> North North America <code>POLYGON ((-166.478008 42.681087, -52.053245 42.681087, -52.053245 72.659041, -166.478008 72.659041, -166.478008 42.681087))</code> <p></p>"},{"location":"datasets-generators/#distribution-options","title":"Distribution Options","text":"<p>By default, SpatialBench generates points using continent-bounded affines with a Hierarchical Thomas distribution for the trip and building tables.  </p> <p>For more realism, you can choose from a variety of spatial distributions when generating tables:</p> <ul> <li>Uniform: Evenly spread points in the unit square.  </li> <li>Normal: Gaussian spread around a mean with configurable variance.  </li> <li>Diagonal: Points concentrated along the y=x diagonal with configurable buffer.  </li> <li>Bit: Recursive grid-like pattern controlled by probability and bit depth.  </li> <li>Sierpinski: Self-similar fractal pattern for highly skewed coverage.  </li> <li>Thomas: Clustered distribution with realistic hotspots and heavy-tailed skew.  </li> <li>Hierarchical Thomas: Multi-level clustering (cities \u2192 neighborhoods \u2192 points), useful for mimicking urban settlement patterns.</li> </ul> <p>These options let you tailor the spatial skew to your benchmarking needs.  </p> <p>See the distributions page to learn more about the supported spatial distributions, the parameters that control them, and how they impact the data.</p>"},{"location":"datasets-generators/#data-generators","title":"Data generators","text":"<p>You can generate the tables for Scale Factor 1 with the following command:</p> <pre><code>spatialbench-cli -s 1 --format=parquet --output-dir sf1-parquet\n</code></pre> <p>Here are the contents of the <code>sf1-parquet</code> directory:</p> <ul> <li><code>building.parquet</code></li> <li><code>customer.parquet</code></li> <li><code>driver.parquet</code></li> <li><code>trip.parquet</code></li> <li><code>vehicle.parquet</code></li> <li><code>zone.parquet</code></li> </ul> <p>See the README for a full description of how to use the SpatialBench data generators.</p>"},{"location":"overview-methodology/","title":"SpatialBench Methodology","text":"<p>SpatialBench is an open benchmark suite of representative spatial queries designed to evaluate the performance of different engines at multiple scale factors.</p> <p>The SpatialBench queries are a great way to compare the relative performance between engines for analytical spatial workloads.  You can use a small scale factor for single-machine queries, and a large scale factor to benchmark an engine that distributes computations in the cloud.</p> <p>Let\u2019s take a deeper look at why SpatialBench is so essential.</p>"},{"location":"overview-methodology/#why-spatialbench","title":"Why SpatialBench?","text":"<p>Spatial workflows encompass queries such as spatial joins, spatial filtering, and spatial-specific operations, including KNN joins.</p> <p>General-purpose analytics query benchmarks don\u2019t cover spatial queries.  They focus on analytical queries, such as joins and aggregations, on tabular data. Here are some popular analytical benchmarks:</p> <ul> <li>TPC-H</li> <li>TPC-DS</li> <li>ClickBench</li> <li>YCSB</li> <li>db-benchmark</li> </ul> <p>The analytical benchmarks help analyze analytical performance, but that doesn\u2019t necessarily translate to spatial queries.  An engine can be blazing fast for a large tabular aggregation and terrible for spatial joins.</p> <p>SpatialBench is tailored for spatial queries.  It\u2019s the best modern option to assess the spatial performance of an engine.  Here are some suggestions for how to use it for the most accurate and fairest results.</p>"},{"location":"overview-methodology/#hardware-and-software","title":"Hardware and software","text":"<p>SpatialBench runs benchmarks on commodity hardware, with software versions fully disclosed for each release.</p> <p>When comparing different runtimes, developers should make a good-faith effort to use similar hardware and software versions.  It\u2019s not helpful to compare one runtime with another runtime that has a lot less computational power.</p> <p>SpatialBench benchmarks should always be presented with associated hardware/software specifications so readers can assess the reliability of the comparison.</p>"},{"location":"overview-methodology/#accurately-comparing-different-engines","title":"Accurately comparing different engines","text":"<p>It is challenging to compare fundamentally different engines, such as PostGIS (an OLTP database), DuckDB (an OLAP database), and GeoPandas (a Python engine).</p> <p>For example, let\u2019s compare how two engines execute a query differently:</p> <ul> <li>PostGIS: create tables, load data into the tables, build an index (can be expensive), run the query</li> <li>GeoPandas: read data into memory and run a query</li> </ul> <p>PostGIS and GeoPandas execute queries differently, so you need to present the query runtime with caution.  For example, you can\u2019t just ignore the time it takes to build the PostGIS index because that can be the slowest part of the query.  That\u2019s a critical detail for users running ad hoc queries.</p> <p>The SpatialBench results strive to present runtimes for all relevant portions of the query so users are best informed about how to interpret the results.</p>"},{"location":"overview-methodology/#engine-tuning-in-benchmarks","title":"Engine tuning in benchmarks","text":"<p>Engines can be tuned by configuring settings or optimizing code.  For example, you can optimize Spark code by tuning the JVM.  You can optimize GeoPandas code by adding indexes.  Benchmarks that tune one engine and don\u2019t tune any of the other engines aren\u2019t reliable.</p> <p>All performance tuning is fully disclosed in the SpatialBench results.  Some results are presented both naively and fully tuned to give a better picture of out-of-the-box performance and what\u2019s possible for expert users.</p>"},{"location":"overview-methodology/#open-source-benchmarks-vs-vendor-benchmarks","title":"Open source benchmarks vs. vendor benchmarks","text":"<p>The SpatialBench benchmarks report results for some open source spatial engines/databases.</p> <p>The SpatialBench repository does not report results for any proprietary engines or vendor runtimes.  Vendors are free to use the SpatialBench data generators and run the benchmarks on their own.  We ask vendors to credit SpatialBench when they run the benchmarks and fully disclose the results so that other practitioners can reproduce the results.</p>"},{"location":"overview-methodology/#how-to-contribute","title":"How to contribute","text":"<p>There are a variety of ways to contribute to the SpatialBench project:</p> <ul> <li>Submit pull requests to add features</li> <li>Create issues for bug reports</li> <li>Reproduce results or help add new spatial engines</li> <li>Publish vendor benchmarks</li> </ul> <p>Here is how you can communicate with the team:</p> <ul> <li>Chat with us on the Apache Sedona Discord</li> <li>Create GitHub Discussions</li> </ul>"},{"location":"overview-methodology/#future-work","title":"Future work","text":"<p>In the next release, we will add raster datasets and raster queries.  These will stress test an engine\u2019s ability to analyze raster data.  They will also show performance when joining vector and raster datasets.</p>"},{"location":"queries/","title":"Run the SpatialBench Queries","text":"<p>This notebook contains the queries that make up the SpatialBench benchmark.</p> <p>SpatialBench is a benchmark for assessing geospatial SQL analytics query performance across database systems. The queries represent common, real-world geospatial analytics tasks and are designed to test a wide range of spatial functions and join conditions.</p> <p>The benchmark uses a realistic but synthetic, transportation-themed dataset to ensure the queries reflect practical use cases. By running these queries, you can evaluate and compare the relative performance of different spatial query engines in a consistent and unbiased manner.</p> In\u00a0[\u00a0]: Copied! <pre>%pip install -r ~/sedona-spatialbench/docs/requirements.txt\n</pre> %pip install -r ~/sedona-spatialbench/docs/requirements.txt <p>Additionally, install the SpatialBench CLI and generate the synthetic data on your machine:</p> <pre><code># SpatialBench CLI\ncargo install --path ./spatialbench-cli\n# Generate the benchmarking data to the sf1-parquet directory\nspatialbench-cli -s 1 --format=parquet --output-dir sf1-parquet\n</code></pre> In\u00a0[34]: Copied! <pre>import sedona.db\n</pre> import sedona.db In\u00a0[35]: Copied! <pre>sd = sedona.db.connect()\n</pre> sd = sedona.db.connect() In\u00a0[36]: Copied! <pre>sd.read_parquet(f\"../sf1-parquet/building.parquet\").to_view(\"building\")\nsd.read_parquet(f\"../sf1-parquet/customer.parquet\").to_view(\"customer\")\nsd.read_parquet(f\"../sf1-parquet/driver.parquet\").to_view(\"driver\")\nsd.read_parquet(f\"../sf1-parquet/trip.parquet\").to_view(\"trip\")\nsd.read_parquet(f\"../sf1-parquet/vehicle.parquet\").to_view(\"vehicle\")\nsd.read_parquet(f\"../sf1-parquet/zone.parquet\").to_view(\"zone\")\n</pre> sd.read_parquet(f\"../sf1-parquet/building.parquet\").to_view(\"building\") sd.read_parquet(f\"../sf1-parquet/customer.parquet\").to_view(\"customer\") sd.read_parquet(f\"../sf1-parquet/driver.parquet\").to_view(\"driver\") sd.read_parquet(f\"../sf1-parquet/trip.parquet\").to_view(\"trip\") sd.read_parquet(f\"../sf1-parquet/vehicle.parquet\").to_view(\"vehicle\") sd.read_parquet(f\"../sf1-parquet/zone.parquet\").to_view(\"zone\") In\u00a0[37]: Copied! <pre>sd.sql(\"\"\"\nSELECT\n    t.t_tripkey,\n    ST_X(ST_GeomFromWKB(t.t_pickuploc)) AS pickup_lon,\n    ST_Y(ST_GeomFromWKB(t.t_pickuploc)) AS pickup_lat,\n    t.t_pickuptime,\n    ST_Distance(\n        ST_GeomFromWKB(t.t_pickuploc),\n        ST_GeomFromText('POINT (-111.7610 34.8697)')\n    ) AS distance_to_center\nFROM trip t\nWHERE ST_DWithin(\n    ST_GeomFromWKB(t.t_pickuploc),\n    ST_GeomFromText('POINT (-111.7610 34.8697)'),\n    0.45 -- 50km radius around Sedona center in degrees\n)\nORDER BY distance_to_center ASC, t.t_tripkey ASC\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" SELECT     t.t_tripkey,     ST_X(ST_GeomFromWKB(t.t_pickuploc)) AS pickup_lon,     ST_Y(ST_GeomFromWKB(t.t_pickuploc)) AS pickup_lat,     t.t_pickuptime,     ST_Distance(         ST_GeomFromWKB(t.t_pickuploc),         ST_GeomFromText('POINT (-111.7610 34.8697)')     ) AS distance_to_center FROM trip t WHERE ST_DWithin(     ST_GeomFromWKB(t.t_pickuploc),     ST_GeomFromText('POINT (-111.7610 34.8697)'),     0.45 -- 50km radius around Sedona center in degrees ) ORDER BY distance_to_center ASC, t.t_tripkey ASC \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 t_tripkey \u2506   pickup_lon   \u2506  pickup_lat  \u2506     t_pickuptime    \u2506  distance_to_center  \u2502\n\u2502   int64   \u2506     float64    \u2506    float64   \u2506      timestamp      \u2506        float64       \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502   1451371 \u2506 -111.791052127 \u2506 34.826733457 \u2506 1998-08-12T06:47:01 \u2506  0.05243333056935387 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502   2047835 \u2506 -111.706967009 \u2506 34.883889472 \u2506 1992-04-08T07:36:09 \u2506 0.055865062714050374 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502   3936870 \u2506 -111.827619221 \u2506 34.882950924 \u2506 1998-11-10T13:32:07 \u2506  0.06792427838042854 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[38]: Copied! <pre>sd.sql(\"\"\"\nSELECT COUNT(*) AS trip_count_in_coconino_county\nFROM trip t\nWHERE ST_Intersects(\n    ST_GeomFromWKB(t.t_pickuploc),\n    (\n        SELECT ST_GeomFromWKB(z.z_boundary)\n        FROM zone z\n        WHERE z.z_name = 'Coconino County'\n        LIMIT 1\n    )\n)\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" SELECT COUNT(*) AS trip_count_in_coconino_county FROM trip t WHERE ST_Intersects(     ST_GeomFromWKB(t.t_pickuploc),     (         SELECT ST_GeomFromWKB(z.z_boundary)         FROM zone z         WHERE z.z_name = 'Coconino County'         LIMIT 1     ) ) \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 trip_count_in_coconino_county \u2502\n\u2502             int64             \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502                           541 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[39]: Copied! <pre>sd.sql(\"\"\"\nSELECT\n    DATE_TRUNC('month', t.t_pickuptime) AS pickup_month,\n    COUNT(t.t_tripkey) AS total_trips,\n    AVG(t.t_distance) AS avg_distance,\n    AVG(t.t_dropofftime - t.t_pickuptime) AS avg_duration,\n    AVG(t.t_fare) AS avg_fare\nFROM trip t\nWHERE ST_DWithin(\n    ST_GeomFromWKB(t.t_pickuploc),\n    ST_GeomFromText('POLYGON((\n        -111.9060 34.7347, -111.6160 34.7347,\n        -111.6160 35.0047, -111.9060 35.0047,\n        -111.9060 34.7347\n    ))'), -- Bounding box around Sedona\n    0.045 -- Additional 5km buffer in degrees\n)\nGROUP BY pickup_month\nORDER BY pickup_month\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" SELECT     DATE_TRUNC('month', t.t_pickuptime) AS pickup_month,     COUNT(t.t_tripkey) AS total_trips,     AVG(t.t_distance) AS avg_distance,     AVG(t.t_dropofftime - t.t_pickuptime) AS avg_duration,     AVG(t.t_fare) AS avg_fare FROM trip t WHERE ST_DWithin(     ST_GeomFromWKB(t.t_pickuploc),     ST_GeomFromText('POLYGON((         -111.9060 34.7347, -111.6160 34.7347,         -111.6160 35.0047, -111.9060 35.0047,         -111.9060 34.7347     ))'), -- Bounding box around Sedona     0.045 -- Additional 5km buffer in degrees ) GROUP BY pickup_month ORDER BY pickup_month \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     pickup_month    \u2506 total_trips \u2506 avg_distance \u2506           avg_duration          \u2506   avg_fare  \u2502\n\u2502      timestamp      \u2506    int64    \u2506  decimal128  \u2506             duration            \u2506  decimal128 \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502 1992-04-01T00:00:00 \u2506           2 \u2506  0.000020000 \u2506 0 days 1 hours 23 mins 47.000 \u2026 \u2506 0.000075000 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502 1992-07-01T00:00:00 \u2506           1 \u2506  0.000010000 \u2506 0 days 0 hours 58 mins 58.000 \u2026 \u2506 0.000040000 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502 1994-02-01T00:00:00 \u2506           2 \u2506  0.000020000 \u2506 0 days 1 hours 23 mins 50.000 \u2026 \u2506 0.000050000 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[40]: Copied! <pre>sd.sql(\"\"\"\nSELECT\n    z.z_zonekey,\n    z.z_name,\n    COUNT(*) AS trip_count\nFROM\n    zone z\n    JOIN (\n        SELECT t.t_pickuploc\n        FROM trip t\n        ORDER BY t.t_tip DESC, t.t_tripkey ASC\n        LIMIT 1000\n    ) top_trips\n    ON ST_Within(\n        ST_GeomFromWKB(top_trips.t_pickuploc),\n        ST_GeomFromWKB(z.z_boundary)\n    )\nGROUP BY z.z_zonekey, z.z_name\nORDER BY trip_count DESC, z.z_zonekey ASC\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" SELECT     z.z_zonekey,     z.z_name,     COUNT(*) AS trip_count FROM     zone z     JOIN (         SELECT t.t_pickuploc         FROM trip t         ORDER BY t.t_tip DESC, t.t_tripkey ASC         LIMIT 1000     ) top_trips     ON ST_Within(         ST_GeomFromWKB(top_trips.t_pickuploc),         ST_GeomFromWKB(z.z_boundary)     ) GROUP BY z.z_zonekey, z.z_name ORDER BY trip_count DESC, z.z_zonekey ASC \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 z_zonekey \u2506              z_name             \u2506 trip_count \u2502\n\u2502   int64   \u2506               utf8              \u2506    int64   \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502     65008 \u2506 Nd\u00e9l\u00e9                           \u2506         35 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502    147530 \u2506 \u4e50\u5c71\u5e02                          \u2506         27 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502    150276 \u2506 \u9521\u6797\u90ed\u52d2\u76df \u1830\u1822\u182f\u1822\u202f\u1836\u1822\u1828 \u182d\u1823\u1823\u182f \u1820\u1836\u1822\u182e\u1820\u182d \u2506         19 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[41]: Copied! <pre>sd.sql(\"\"\"\nSELECT\n    c.c_custkey,\n    c.c_name AS customer_name,\n    DATE_TRUNC('month', t.t_pickuptime) AS pickup_month,\n    ST_Area(\n        ST_ConvexHull(ST_Collect(ST_GeomFromWKB(t.t_dropoffloc)))\n    ) AS monthly_travel_hull_area,\n    COUNT(*) as dropoff_count\nFROM trip t\nJOIN customer c\n    ON t.t_custkey = c.c_custkey\nGROUP BY c.c_custkey, c.c_name, pickup_month\nHAVING dropoff_count &gt; 5 -- Only include repeat customers\nORDER BY monthly_travel_hull_area DESC, c.c_custkey ASC\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" SELECT     c.c_custkey,     c.c_name AS customer_name,     DATE_TRUNC('month', t.t_pickuptime) AS pickup_month,     ST_Area(         ST_ConvexHull(ST_Collect(ST_GeomFromWKB(t.t_dropoffloc)))     ) AS monthly_travel_hull_area,     COUNT(*) as dropoff_count FROM trip t JOIN customer c     ON t.t_custkey = c.c_custkey GROUP BY c.c_custkey, c.c_name, pickup_month HAVING dropoff_count &gt; 5 -- Only include repeat customers ORDER BY monthly_travel_hull_area DESC, c.c_custkey ASC \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 c_custkey \u2506    customer_name   \u2506     pickup_month    \u2506 monthly_travel_hul \u2506 dropoff_count \u2502\n\u2502   int64   \u2506        utf8        \u2506      timestamp      \u2506       l_area\u2026      \u2506     int64     \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502     25975 \u2506 Customer#000025975 \u2506 1992-02-01T00:00:00 \u2506 34941.303419053635 \u2506            10 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502     12061 \u2506 Customer#000012061 \u2506 1997-03-01T00:00:00 \u2506  34607.53871953154 \u2506            14 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502     21418 \u2506 Customer#000021418 \u2506 1993-08-01T00:00:00 \u2506  34465.32323910264 \u2506             9 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[42]: Copied! <pre>sd.sql(\"\"\"\nSELECT\n    z.z_zonekey,\n    z.z_name,\n    COUNT(t.t_tripkey) AS total_pickups,\n    AVG(t.t_distance) AS avg_distance, -- Corrected from t_totalamount\n    AVG(t.t_dropofftime - t.t_pickuptime) AS avg_duration\nFROM trip t, zone z\nWHERE ST_Intersects(\n    ST_GeomFromText('POLYGON((\n        -112.2110 34.4197, -111.3110 34.4197,\n        -111.3110 35.3197, -112.2110 35.3197,\n        -112.2110 34.4197\n    ))'), -- Bounding box around Sedona\n    ST_GeomFromWKB(z.z_boundary)\n  )\n  AND ST_Within(\n    ST_GeomFromWKB(t.t_pickuploc),\n    ST_GeomFromWKB(z.z_boundary)\n  )\nGROUP BY z.z_zonekey, z.z_name\nORDER BY total_pickups DESC, z.z_zonekey ASC\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" SELECT     z.z_zonekey,     z.z_name,     COUNT(t.t_tripkey) AS total_pickups,     AVG(t.t_distance) AS avg_distance, -- Corrected from t_totalamount     AVG(t.t_dropofftime - t.t_pickuptime) AS avg_duration FROM trip t, zone z WHERE ST_Intersects(     ST_GeomFromText('POLYGON((         -112.2110 34.4197, -111.3110 34.4197,         -111.3110 35.3197, -112.2110 35.3197,         -112.2110 34.4197     ))'), -- Bounding box around Sedona     ST_GeomFromWKB(z.z_boundary)   )   AND ST_Within(     ST_GeomFromWKB(t.t_pickuploc),     ST_GeomFromWKB(z.z_boundary)   ) GROUP BY z.z_zonekey, z.z_name ORDER BY total_pickups DESC, z.z_zonekey ASC \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 z_zonekey \u2506      z_name     \u2506 total_pickups \u2506 avg_distance \u2506            avg_duration            \u2502\n\u2502   int64   \u2506       utf8      \u2506     int64     \u2506  decimal128  \u2506              duration              \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502     30084 \u2506 Coconino County \u2506           541 \u2506  0.000030406 \u2506 0 days 1 hours 45 mins 16.591 secs \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502     30083 \u2506 Yavapai County  \u2506           292 \u2506  0.000027157 \u2506 0 days 1 hours 36 mins 43.647 secs \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502     29488 \u2506 Gila County     \u2506            39 \u2506  0.000021282 \u2506 0 days 1 hours 16 mins 59.769 secs \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[43]: Copied! <pre>sd.sql(\"\"\"\nWITH trip_lengths AS (\n    SELECT\n        t.t_tripkey,\n        t.t_distance AS reported_distance_m,\n        ST_Length(\n            ST_MakeLine(\n                ST_GeomFromWKB(t.t_pickuploc),\n                ST_GeomFromWKB(t.t_dropoffloc)\n            )\n        ) * 111111 AS line_distance_m -- Approx. meters per degree\n    FROM trip t\n)\nSELECT\n    t.t_tripkey,\n    t.reported_distance_m,\n    t.line_distance_m,\n    t.reported_distance_m / NULLIF(t.line_distance_m, 0) AS detour_ratio\nFROM trip_lengths t\nORDER BY\n    detour_ratio DESC NULLS LAST,\n    reported_distance_m DESC,\n    t_tripkey ASC\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" WITH trip_lengths AS (     SELECT         t.t_tripkey,         t.t_distance AS reported_distance_m,         ST_Length(             ST_MakeLine(                 ST_GeomFromWKB(t.t_pickuploc),                 ST_GeomFromWKB(t.t_dropoffloc)             )         ) * 111111 AS line_distance_m -- Approx. meters per degree     FROM trip t ) SELECT     t.t_tripkey,     t.reported_distance_m,     t.line_distance_m,     t.reported_distance_m / NULLIF(t.line_distance_m, 0) AS detour_ratio FROM trip_lengths t ORDER BY     detour_ratio DESC NULLS LAST,     reported_distance_m DESC,     t_tripkey ASC \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 t_tripkey \u2506 reported_distance_m \u2506   line_distance_m  \u2506     detour_ratio     \u2502\n\u2502   int64   \u2506      decimal128     \u2506       float64      \u2506        float64       \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502   4688563 \u2506             0.00010 \u2506 11111.114941555596 \u2506 8.999996897341038e-9 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502   2380123 \u2506             0.00010 \u2506 11111.114983939786 \u2506 8.999996863009868e-9 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502   3077131 \u2506             0.00010 \u2506 11111.115027455284 \u2506 8.999996827762339e-9 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[44]: Copied! <pre>sd.sql(\"\"\"\nSELECT b.b_buildingkey, b.b_name, COUNT(*) AS nearby_pickup_count\nFROM trip t\nJOIN building b\nON ST_DWithin(ST_GeomFromWKB(t.t_pickuploc), ST_GeomFromWKB(b.b_boundary), 0.0045) -- ~500m\nGROUP BY b.b_buildingkey, b.b_name\nORDER BY nearby_pickup_count DESC, b.b_buildingkey ASC\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" SELECT b.b_buildingkey, b.b_name, COUNT(*) AS nearby_pickup_count FROM trip t JOIN building b ON ST_DWithin(ST_GeomFromWKB(t.t_pickuploc), ST_GeomFromWKB(b.b_boundary), 0.0045) -- ~500m GROUP BY b.b_buildingkey, b.b_name ORDER BY nearby_pickup_count DESC, b.b_buildingkey ASC \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 b_buildingkey \u2506 b_name \u2506 nearby_pickup_count \u2502\n\u2502     int64     \u2506  utf8  \u2506        int64        \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502          3779 \u2506 linen  \u2506                  42 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502         19135 \u2506 misty  \u2506                  36 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502          4416 \u2506 sienna \u2506                  26 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[45]: Copied! <pre>sd.sql(\"\"\"\nWITH b1 AS (\n   SELECT b_buildingkey AS id, ST_GeomFromWKB(b_boundary) AS geom\n   FROM building\n),\nb2 AS (\n    SELECT b_buildingkey AS id, ST_GeomFromWKB(b_boundary) AS geom\n    FROM building\n),\npairs AS (\n    SELECT\n        b1.id AS building_1,\n        b2.id AS building_2,\n        ST_Area(b1.geom) AS area1,\n        ST_Area(b2.geom) AS area2,\n        ST_Area(ST_Intersection(b1.geom, b2.geom)) AS overlap_area\n    FROM b1\n    JOIN b2 ON b1.id &lt; b2.id AND ST_Intersects(b1.geom, b2.geom)\n)\nSELECT\n   building_1,\n   building_2,\n   area1,\n   area2,\n   overlap_area,\n   CASE\n       WHEN (area1 + area2 - overlap_area) = 0 THEN 1.0\n       ELSE overlap_area / (area1 + area2 - overlap_area)\n   END AS iou\nFROM pairs\nORDER BY iou DESC, building_1 ASC, building_2 ASC\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" WITH b1 AS (    SELECT b_buildingkey AS id, ST_GeomFromWKB(b_boundary) AS geom    FROM building ), b2 AS (     SELECT b_buildingkey AS id, ST_GeomFromWKB(b_boundary) AS geom     FROM building ), pairs AS (     SELECT         b1.id AS building_1,         b2.id AS building_2,         ST_Area(b1.geom) AS area1,         ST_Area(b2.geom) AS area2,         ST_Area(ST_Intersection(b1.geom, b2.geom)) AS overlap_area     FROM b1     JOIN b2 ON b1.id &lt; b2.id AND ST_Intersects(b1.geom, b2.geom) ) SELECT    building_1,    building_2,    area1,    area2,    overlap_area,    CASE        WHEN (area1 + area2 - overlap_area) = 0 THEN 1.0        ELSE overlap_area / (area1 + area2 - overlap_area)    END AS iou FROM pairs ORDER BY iou DESC, building_1 ASC, building_2 ASC \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 building_1 \u2506 building_2 \u2506 \u2026 \u2506      overlap_area     \u2506         iou        \u2502\n\u2502    int64   \u2506    int64   \u2506   \u2506        float64        \u2506       float64      \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502       2285 \u2506      15719 \u2506 \u2026 \u2506 2.3709162946727276e-6 \u2506 0.9056816071717889 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502       7562 \u2506      18534 \u2506 \u2026 \u2506  5.855106543747764e-6 \u2506 0.8450437137796769 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502       2285 \u2506      13658 \u2506 \u2026 \u2506 1.9770693222933237e-6 \u2506  0.737899157380637 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[46]: Copied! <pre>sd.sql(\"\"\"\nSELECT\n    z.z_zonekey,\n    z.z_name AS pickup_zone,\n    AVG(t.t_dropofftime - t.t_pickuptime) AS avg_duration,\n    AVG(t.t_distance) AS avg_distance,\n    COUNT(t.t_tripkey) AS num_trips\nFROM\n    zone z\n    LEFT JOIN trip t\n    ON ST_Within(\n        ST_GeomFromWKB(t.t_pickuploc), ST_GeomFromWKB(z.z_boundary)\n    )\nGROUP BY z.z_zonekey, z.z_name\nORDER BY avg_duration DESC NULLS LAST, z.z_zonekey ASC\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" SELECT     z.z_zonekey,     z.z_name AS pickup_zone,     AVG(t.t_dropofftime - t.t_pickuptime) AS avg_duration,     AVG(t.t_distance) AS avg_distance,     COUNT(t.t_tripkey) AS num_trips FROM     zone z     LEFT JOIN trip t     ON ST_Within(         ST_GeomFromWKB(t.t_pickuploc), ST_GeomFromWKB(z.z_boundary)     ) GROUP BY z.z_zonekey, z.z_name ORDER BY avg_duration DESC NULLS LAST, z.z_zonekey ASC \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 z_zonekey \u2506   pickup_zone  \u2506            avg_duration            \u2506 avg_distance \u2506 num_trips \u2502\n\u2502   int64   \u2506      utf8      \u2506              duration              \u2506  decimal128  \u2506   int64   \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502     31558 \u2506 Benewah County \u2506 4 days 13 hours 3 mins 34.000 secs \u2506  0.002180000 \u2506         2 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502    119540 \u2506 Kreis Unna     \u2506 2 days 4 hours 52 mins 44.000 secs \u2506  0.001050000 \u2506         1 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502     59928 \u2506 Ndhiwa         \u2506 2 days 4 hours 19 mins 39.000 secs \u2506  0.001040000 \u2506         1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[47]: Copied! <pre>sd.sql(\"\"\"\nSELECT COUNT(*) AS cross_zone_trip_count\nFROM\n    trip t\n    JOIN zone pickup_zone\n        ON ST_Within(\n            ST_GeomFromWKB(t.t_pickuploc),\n            ST_GeomFromWKB(pickup_zone.z_boundary)\n        )\n    JOIN zone dropoff_zone\n        ON ST_Within(\n            ST_GeomFromWKB(t.t_dropoffloc),\n            ST_GeomFromWKB(dropoff_zone.z_boundary)\n        )\nWHERE pickup_zone.z_zonekey != dropoff_zone.z_zonekey\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" SELECT COUNT(*) AS cross_zone_trip_count FROM     trip t     JOIN zone pickup_zone         ON ST_Within(             ST_GeomFromWKB(t.t_pickuploc),             ST_GeomFromWKB(pickup_zone.z_boundary)         )     JOIN zone dropoff_zone         ON ST_Within(             ST_GeomFromWKB(t.t_dropoffloc),             ST_GeomFromWKB(dropoff_zone.z_boundary)         ) WHERE pickup_zone.z_zonekey != dropoff_zone.z_zonekey \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 cross_zone_trip_count \u2502\n\u2502         int64         \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502                176391 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre> In\u00a0[48]: Copied! <pre>sd.sql(\"\"\"\nWITH trip_with_geom AS (\n    SELECT\n        t_tripkey,\n        t_pickuploc,\n        ST_GeomFromWKB(t_pickuploc) as pickup_geom\n    FROM trip\n),\nbuilding_with_geom AS (\n    SELECT\n        b_buildingkey,\n        b_name,\n        b_boundary,\n        ST_GeomFromWKB(b_boundary) as boundary_geom\n    FROM building\n)\nSELECT\n    t.t_tripkey,\n    t.t_pickuploc,\n    b.b_buildingkey,\n    b.b_name AS building_name,\n    ST_Distance(t.pickup_geom, b.boundary_geom) AS distance_to_building\nFROM trip_with_geom t\nJOIN building_with_geom b\n    ON ST_KNN(t.pickup_geom, b.boundary_geom, 5, FALSE)\nORDER BY t.t_tripkey ASC, distance_to_building ASC, b.b_buildingkey ASC\n\"\"\").show(3)\n</pre> sd.sql(\"\"\" WITH trip_with_geom AS (     SELECT         t_tripkey,         t_pickuploc,         ST_GeomFromWKB(t_pickuploc) as pickup_geom     FROM trip ), building_with_geom AS (     SELECT         b_buildingkey,         b_name,         b_boundary,         ST_GeomFromWKB(b_boundary) as boundary_geom     FROM building ) SELECT     t.t_tripkey,     t.t_pickuploc,     b.b_buildingkey,     b.b_name AS building_name,     ST_Distance(t.pickup_geom, b.boundary_geom) AS distance_to_building FROM trip_with_geom t JOIN building_with_geom b     ON ST_KNN(t.pickup_geom, b.boundary_geom, 5, FALSE) ORDER BY t.t_tripkey ASC, distance_to_building ASC, b.b_buildingkey ASC \"\"\").show(3) <pre>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 t_tripkey \u2506           t_pickuploc           \u2506 b_buildingkey \u2506 building_name \u2506 distance_to_buildi \u2502\n\u2502   int64   \u2506              binary             \u2506     int64     \u2506      utf8     \u2506         ng\u2026        \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502         1 \u2506 01010000009f3c318dd43735405930\u2026 \u2506         15870 \u2506 purple        \u2506  0.984633987957188 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502         1 \u2506 01010000009f3c318dd43735405930\u2026 \u2506          6800 \u2506 ghost         \u2506  1.205725156670704 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502         1 \u2506 01010000009f3c318dd43735405930\u2026 \u2506          8384 \u2506 lavender      \u2506 1.4195012994942622 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</pre>"},{"location":"queries/#run-the-spatialbench-queries","title":"Run the SpatialBench Queries\u00b6","text":""},{"location":"queries/#before-you-start","title":"Before you start\u00b6","text":"<p>Before running this notebook, ensure that you have installed the packages in the <code>requirements.txt</code> file:</p>"},{"location":"queries/#q1-find-trips-starting-within-50km-of-sedona-city-center-ordered-by-distance","title":"Q1: Find trips starting within 50km of Sedona city center, ordered by distance\u00b6","text":"<p>Real-life scenario: Identify and rank trips by proximity to a city center for urban planning and transportation analysis.</p> <p>This query finds all taxi or rideshare trips that started within 50 kilometers of downtown Sedona, Arizona. For each qualifying trip, it shows the trip ID, pickup coordinates, pickup time, and calculates the exact distance from the pickup location to Sedona's city center. The results are sorted to show the trips that picked up closest to downtown Sedona first, making it easy to see which rides originated nearest to the city center.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Distance-based spatial filtering (ST_DWithin)</li> <li>Distance calculation to a fixed point</li> <li>Coordinate extraction (ST_X, ST_Y)</li> <li>Ordering by spatial distance</li> </ol>"},{"location":"queries/#q2-count-trips-starting-within-coconino-county-arizona-zone","title":"Q2: Count trips starting within Coconino County (Arizona) zone\u00b6","text":"<p>Real-life scenario: Count all trips originating within a specific administrative boundary (county) for regional transportation statistics.</p> <p>This query counts how many taxi or rideshare trips started within Coconino County, Arizona. It does this by checking if each trip's pickup location falls inside the county's geographic boundaries. The result is a simple count showing the total number of trips that originated anywhere within Coconino County.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Point-in-polygon spatial filtering (ST_Intersects)</li> <li>Subquery with spatial geometry selection</li> <li>Simple aggregation on spatially filtered data</li> </ol>"},{"location":"queries/#q3-monthly-trip-statistics-within-a-15km-radius-of-the-sedona-city-center","title":"Q3: Monthly trip statistics within a 15km radius of the Sedona city center\u00b6","text":"<p>Real-life scenario: Track monthly travel trends and performance metrics in a metropolitan area with seasonal analysis.</p> <p>This query analyzes taxi and rideshare trip patterns around Sedona, Arizona, by grouping trips into monthly summaries. It looks at all trips that started within a 15-kilometer area around Sedona (a 10km box plus 5km buffer) and calculates key statistics for each month, including total number of trips, average trip distance, average trip duration, and average fare. The results are organized chronologically by month, allowing you to see seasonal trends and changes in ride patterns over time in the Sedona area.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Distance-based spatial filtering (ST_DWithin) with buffer</li> <li>Temporal grouping (monthly aggregation)</li> <li>Multiple statistical aggregations on spatially filtered data</li> </ol>"},{"location":"queries/#q4-zone-distribution-of-top-1000-trips-by-tip-amount","title":"Q4: Zone distribution of top 1000 trips by tip amount\u00b6","text":"<p>Real-life scenario: Analyze the geographic distribution of high-value trips (by tip amount) to understand premium service areas.</p> <p>This query identifies which neighborhoods or zones produced the most generous tippers by analyzing the top 1000 highest-tipping trips. It first finds the 1000 trips with the largest tips, then determines which geographic zones or neighborhoods those pickup locations fall within, and counts how many of these high-tip trips originated from each area. The results show a ranking of zones by the number of big tippers they produced, helping identify the most lucrative pickup areas for drivers seeking high-tip rides.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Subquery with ordering and limiting</li> <li>Point-in-polygon spatial join (ST_Within)</li> <li>Aggregation on spatially joined results</li> <li>Multi-step query with spatial filtering and grouping</li> </ol>"},{"location":"queries/#q5-monthly-travel-patterns-for-repeat-customers-convex-hull-of-dropoff-locations","title":"Q5: Monthly travel patterns for repeat customers (convex hull of dropoff locations)\u00b6","text":"<p>Real-life scenario: Analyze the geographic spread of travel patterns for frequent customers to understand their mobility behavior.</p> <p>This query analyzes the monthly travel patterns of frequent customers by measuring how much geographic area they cover with their trips. For each customer who took more than five trips in a month, it calculates the size of the \"travel hull\" - the area enclosed by connecting all their dropoff locations that month. The results reveal which customers have the most expansive travel patterns, helping to identify power users who cover large geographic areas versus those who stick to smaller, local areas.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Spatial aggregation (ST_Collect/ARRAY_AGG)</li> <li>Convex hull computation (ST_ConvexHull)</li> <li>Area calculation on complex geometries</li> <li>Temporal and customer-based grouping with spatial operations</li> </ol>"},{"location":"queries/#q6-zone-statistics-for-trips-within-a-50km-radius-of-the-sedona-city-center","title":"Q6: Zone statistics for trips within a 50km radius of the Sedona city center\u00b6","text":"<p>Real-life scenario: Analyze trip patterns in zones within a metropolitan area around a specific city center.</p> <p>This query analyzes ride activity across all neighborhoods and zones within a 50-kilometer area around Sedona, Arizona. It identifies which zones had the most pickup activity by counting total trips that started in each region. Also, it calculates the average trip cost and duration for rides originating from each zone. The results are ranked by pickup volume, showing which neighborhoods or areas generate the most ride demand and their typical trip characteristics within the greater Sedona region.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Polygon containment check (ST_Contains) with bounding box</li> <li>Point-in-polygon spatial join (ST_Within)</li> </ol>"},{"location":"queries/#q7-detect-potential-route-detours-by-comparing-reported-vs-geometric-distances","title":"Q7: Detect potential route detours by comparing reported vs. geometric distances\u00b6","text":"<p>Real-life scenario: Identify suspicious trips where the reported distance significantly exceeds the straight-line distance, potentially indicating fare manipulation.</p> <p>This query analyzes how much taxi and rideshare trips deviate from the most direct route by comparing the actual reported trip distance to the straight-line distance between pickup and dropoff points. It calculates a \"detour ratio\" that shows how much longer the actual route was compared to flying in a straight line.  For example, a ratio of 1.5 means the trip was 50% longer than the direct path. The results are sorted to show the trips with the highest detour ratios first, helping identify routes that took significant detours due to traffic, road layouts, or other factors.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Line geometry creation (ST_MakeLine)</li> <li>Length calculation (ST_Length)</li> <li>Coordinate system conversion and distance calculations</li> <li>Ratio-based filtering on geometric vs. reported measurements</li> </ol>"},{"location":"queries/#q8-count-nearby-pickups-for-each-building-within-a-500m-radius","title":"Q8: Count nearby pickups for each building within a 500m radius\u00b6","text":"<p>Real-life scenario: Count how many trips start within 500 meters of each building.</p> <p>This query identifies which buildings generate the most taxi and rideshare pickup activity by counting trips that started within 500 meters of each building. It analyzes the relationship between specific buildings (like hotels, shopping centers, airports, or office buildings) and ride demand in their immediate vicinity. The results are ranked to show which buildings are the biggest trip generators, helping identify key pickup hotspots and understand how different types of buildings drive transportation demand.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Distance spatial join between points and polygons</li> <li>Aggregation on spatial join result</li> </ol>"},{"location":"queries/#q9-building-conflation-duplicateoverlap-detection-via-iou","title":"Q9: Building Conflation (duplicate/overlap detection via IoU)\u00b6","text":"<p>Real-life scenario: Detect duplicate or overlapping building footprints in GIS datasets to identify data quality issues.</p> <p>This query identifies overlapping buildings by calculating how much their footprints intersect with each other. For every pair of buildings that touch or overlap, it measures the total area of each building and the area where they overlap, then calculates an \"Intersection over Union\" (IoU) score that ranges from 0 to 1. The results are sorted by IoU score to show the most significantly overlapping building pairs first, which could help identify data quality issues, adjacent structures, or buildings that share common areas like courtyards or parking lots.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Self-join with spatial intersection (ST_Intersects)</li> <li>Area calculations (ST_Area)</li> <li>Geometric intersection operations (ST_Intersection)</li> <li>Complex geometric ratio calculations (IoU - Intersection over Union)</li> </ol>"},{"location":"queries/#q10-zone-statistics-for-trips-starting-within-each-zone","title":"Q10: Zone statistics for trips starting within each zone\u00b6","text":"<p>Real-life scenario: Analyze trip patterns and performance metrics for each administrative zone (like city districts or neighborhoods).</p> <p>This query analyzes trip patterns across all geographic zones by calculating average trip duration, distance, and volume for rides originating from each area. It uses a left join to include all zones in the results, even those with no pickup activity, showing which neighborhoods generate longer trips on average versus shorter local rides. The results are sorted by average trip duration to identify zones where people tend to take longer journeys, which could indicate more isolated areas, have limited local amenities, or serve as departure points for longer-distance travel.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Point-in-polygon spatial join (ST_Within)</li> <li>Aggregation with multiple metrics (average duration, distance, count)</li> <li>LEFT JOIN to include zones with no trips</li> </ol>"},{"location":"queries/#q11-count-trips-that-cross-between-different-zones","title":"Q11: Count trips that cross between different zones\u00b6","text":"<p>Real-life scenario: Identify inter-district or inter-city trips to understand cross-boundary travel patterns.</p> <p>This query counts how many trips crossed zone boundaries by starting in one geographic zone and ending in a different zone. It identifies each trip's pickup and dropoff zones, then filters to only include trips where the pickup zone is different from the dropoff zone. The result shows the total number of inter-zone trips, helping measure how much travel occurs between different neighborhoods, districts, or areas rather than staying within the same local zone.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Multiple point-in-polygon spatial joins</li> <li>Filtering based on spatial relationship results</li> </ol>"},{"location":"queries/#q12-find-five-nearest-buildings-to-each-trip-pickup-location-using-knn-join","title":"Q12: Find five nearest buildings to each trip pickup location using KNN join\u00b6","text":"<p>Real-life scenario: Identify the closest landmarks or buildings to each trip start point for location context and navigation.</p> <p>This query finds the 5 closest buildings to each trip pickup location using spatial nearest neighbor analysis. For every trip, it identifies the five buildings that are geographically closest to where the passenger was picked up and calculates the exact distance to each of those buildings. The results show which buildings are most commonly near pickup points, helping understand the relationship between trip origins and nearby landmarks, businesses, or residential structures that might influence ride demand patterns.</p> <p>Spatial query characteristics tested:</p> <ol> <li>K-nearest neighbor (KNN) spatial join</li> <li>Distance calculations between points and polygons</li> <li>Ranking and limiting results based on spatial proximity</li> </ol>"},{"location":"queries/","title":"Run the SpatialBench Queries","text":""},{"location":"queries/#run-the-spatialbench-queries","title":"Run the SpatialBench Queries","text":"<p>This notebook contains the queries that make up the SpatialBench benchmark.</p> <p>SpatialBench is a benchmark for assessing geospatial SQL analytics query performance across database systems. The queries represent common, real-world geospatial analytics tasks and are designed to test a wide range of spatial functions and join conditions.</p> <p>The benchmark uses a realistic but synthetic, transportation-themed dataset to ensure the queries reflect practical use cases. By running these queries, you can evaluate and compare the relative performance of different spatial query engines in a consistent and unbiased manner.</p>"},{"location":"queries/#before-you-start","title":"Before you start","text":"<p>Before running this notebook, ensure that you have installed the packages in the <code>requirements.txt</code> file:</p> <pre><code>%pip install -r ~/sedona-spatialbench/docs/requirements.txt\n</code></pre> <pre><code>...\n...\nNote: you may need to restart the kernel to use updated packages.\n</code></pre> <p>Additionally, install the SpatialBench CLI and generate the synthetic data on your machine:</p> <pre><code># SpatialBench CLI\ncargo install --path ./spatialbench-cli\n# Generate the benchmarking data to the sf1-parquet directory\nspatialbench-cli -s 1 --format=parquet --output-dir sf1-parquet\n</code></pre> <pre><code>import sedona.db\n</code></pre> <pre><code>sd = sedona.db.connect()\n</code></pre> <pre><code>sd.read_parquet(f\"../sf1-parquet/building.parquet\").to_view(\"building\")\nsd.read_parquet(f\"../sf1-parquet/customer.parquet\").to_view(\"customer\")\nsd.read_parquet(f\"../sf1-parquet/driver.parquet\").to_view(\"driver\")\nsd.read_parquet(f\"../sf1-parquet/trip.parquet\").to_view(\"trip\")\nsd.read_parquet(f\"../sf1-parquet/vehicle.parquet\").to_view(\"vehicle\")\nsd.read_parquet(f\"../sf1-parquet/zone.parquet\").to_view(\"zone\")\n</code></pre>"},{"location":"queries/#q1-find-trips-starting-within-50km-of-sedona-city-center-ordered-by-distance","title":"Q1: Find trips starting within 50km of Sedona city center, ordered by distance","text":"<p>Real-life scenario: Identify and rank trips by proximity to a city center for urban planning and transportation analysis.</p> <p>This query finds all taxi or rideshare trips that started within 50 kilometers of downtown Sedona, Arizona. For each qualifying trip, it shows the trip ID, pickup coordinates, pickup time, and calculates the exact distance from the pickup location to Sedona's city center. The results are sorted to show the trips that picked up closest to downtown Sedona first, making it easy to see which rides originated nearest to the city center.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Distance-based spatial filtering (ST_DWithin)</li> <li>Distance calculation to a fixed point</li> <li>Coordinate extraction (ST_X, ST_Y)</li> <li>Ordering by spatial distance</li> </ol> <pre><code>sd.sql(\"\"\"\nSELECT\n    t.t_tripkey,\n    ST_X(ST_GeomFromWKB(t.t_pickuploc)) AS pickup_lon,\n    ST_Y(ST_GeomFromWKB(t.t_pickuploc)) AS pickup_lat,\n    t.t_pickuptime,\n    ST_Distance(\n        ST_GeomFromWKB(t.t_pickuploc),\n        ST_GeomFromText('POINT (-111.7610 34.8697)')\n    ) AS distance_to_center\nFROM trip t\nWHERE ST_DWithin(\n    ST_GeomFromWKB(t.t_pickuploc),\n    ST_GeomFromText('POINT (-111.7610 34.8697)'),\n    0.45 -- 50km radius around Sedona center in degrees\n)\nORDER BY distance_to_center ASC, t.t_tripkey ASC\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 t_tripkey \u2506   pickup_lon   \u2506  pickup_lat  \u2506     t_pickuptime    \u2506  distance_to_center  \u2502\n\u2502   int64   \u2506     float64    \u2506    float64   \u2506      timestamp      \u2506        float64       \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502   1451371 \u2506 -111.791052127 \u2506 34.826733457 \u2506 1998-08-12T06:47:01 \u2506  0.05243333056935387 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502   2047835 \u2506 -111.706967009 \u2506 34.883889472 \u2506 1992-04-08T07:36:09 \u2506 0.055865062714050374 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502   3936870 \u2506 -111.827619221 \u2506 34.882950924 \u2506 1998-11-10T13:32:07 \u2506  0.06792427838042854 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q2-count-trips-starting-within-coconino-county-arizona-zone","title":"Q2: Count trips starting within Coconino County (Arizona) zone","text":"<p>Real-life scenario: Count all trips originating within a specific administrative boundary (county) for regional transportation statistics.</p> <p>This query counts how many taxi or rideshare trips started within Coconino County, Arizona. It does this by checking if each trip's pickup location falls inside the county's geographic boundaries. The result is a simple count showing the total number of trips that originated anywhere within Coconino County.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Point-in-polygon spatial filtering (ST_Intersects)</li> <li>Subquery with spatial geometry selection</li> <li>Simple aggregation on spatially filtered data</li> </ol> <pre><code>sd.sql(\"\"\"\nSELECT COUNT(*) AS trip_count_in_coconino_county\nFROM trip t\nWHERE ST_Intersects(\n    ST_GeomFromWKB(t.t_pickuploc),\n    (\n        SELECT ST_GeomFromWKB(z.z_boundary)\n        FROM zone z\n        WHERE z.z_name = 'Coconino County'\n        LIMIT 1\n    )\n)\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 trip_count_in_coconino_county \u2502\n\u2502             int64             \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502                           541 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q3-monthly-trip-statistics-within-a-15km-radius-of-the-sedona-city-center","title":"Q3: Monthly trip statistics within a 15km radius of the Sedona city center","text":"<p>Real-life scenario: Track monthly travel trends and performance metrics in a metropolitan area with seasonal analysis.</p> <p>This query analyzes taxi and rideshare trip patterns around Sedona, Arizona, by grouping trips into monthly summaries. It looks at all trips that started within a 15-kilometer area around Sedona (a 10km box plus 5km buffer) and calculates key statistics for each month, including total number of trips, average trip distance, average trip duration, and average fare. The results are organized chronologically by month, allowing you to see seasonal trends and changes in ride patterns over time in the Sedona area.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Distance-based spatial filtering (ST_DWithin) with buffer</li> <li>Temporal grouping (monthly aggregation)</li> <li>Multiple statistical aggregations on spatially filtered data</li> </ol> <pre><code>sd.sql(\"\"\"\nSELECT\n    DATE_TRUNC('month', t.t_pickuptime) AS pickup_month,\n    COUNT(t.t_tripkey) AS total_trips,\n    AVG(t.t_distance) AS avg_distance,\n    AVG(t.t_dropofftime - t.t_pickuptime) AS avg_duration,\n    AVG(t.t_fare) AS avg_fare\nFROM trip t\nWHERE ST_DWithin(\n    ST_GeomFromWKB(t.t_pickuploc),\n    ST_GeomFromText('POLYGON((\n        -111.9060 34.7347, -111.6160 34.7347,\n        -111.6160 35.0047, -111.9060 35.0047,\n        -111.9060 34.7347\n    ))'), -- Bounding box around Sedona\n    0.045 -- Additional 5km buffer in degrees\n)\nGROUP BY pickup_month\nORDER BY pickup_month\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     pickup_month    \u2506 total_trips \u2506 avg_distance \u2506           avg_duration          \u2506   avg_fare  \u2502\n\u2502      timestamp      \u2506    int64    \u2506  decimal128  \u2506             duration            \u2506  decimal128 \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502 1992-04-01T00:00:00 \u2506           2 \u2506  0.000020000 \u2506 0 days 1 hours 23 mins 47.000 \u2026 \u2506 0.000075000 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502 1992-07-01T00:00:00 \u2506           1 \u2506  0.000010000 \u2506 0 days 0 hours 58 mins 58.000 \u2026 \u2506 0.000040000 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502 1994-02-01T00:00:00 \u2506           2 \u2506  0.000020000 \u2506 0 days 1 hours 23 mins 50.000 \u2026 \u2506 0.000050000 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q4-zone-distribution-of-top-1000-trips-by-tip-amount","title":"Q4: Zone distribution of top 1000 trips by tip amount","text":"<p>Real-life scenario: Analyze the geographic distribution of high-value trips (by tip amount) to understand premium service areas.</p> <p>This query identifies which neighborhoods or zones produced the most generous tippers by analyzing the top 1000 highest-tipping trips. It first finds the 1000 trips with the largest tips, then determines which geographic zones or neighborhoods those pickup locations fall within, and counts how many of these high-tip trips originated from each area. The results show a ranking of zones by the number of big tippers they produced, helping identify the most lucrative pickup areas for drivers seeking high-tip rides.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Subquery with ordering and limiting</li> <li>Point-in-polygon spatial join (ST_Within)</li> <li>Aggregation on spatially joined results</li> <li>Multi-step query with spatial filtering and grouping</li> </ol> <pre><code>sd.sql(\"\"\"\nSELECT\n    z.z_zonekey,\n    z.z_name,\n    COUNT(*) AS trip_count\nFROM\n    zone z\n    JOIN (\n        SELECT t.t_pickuploc\n        FROM trip t\n        ORDER BY t.t_tip DESC, t.t_tripkey ASC\n        LIMIT 1000\n    ) top_trips\n    ON ST_Within(\n        ST_GeomFromWKB(top_trips.t_pickuploc),\n        ST_GeomFromWKB(z.z_boundary)\n    )\nGROUP BY z.z_zonekey, z.z_name\nORDER BY trip_count DESC, z.z_zonekey ASC\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 z_zonekey \u2506              z_name             \u2506 trip_count \u2502\n\u2502   int64   \u2506               utf8              \u2506    int64   \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502     65008 \u2506 Nd\u00e9l\u00e9                           \u2506         35 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502    147530 \u2506 \u4e50\u5c71\u5e02                          \u2506         27 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502    150276 \u2506 \u9521\u6797\u90ed\u52d2\u76df \u1830\u1822\u182f\u1822\u202f\u1836\u1822\u1828 \u182d\u1823\u1823\u182f \u1820\u1836\u1822\u182e\u1820\u182d \u2506         19 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q5-monthly-travel-patterns-for-repeat-customers-convex-hull-of-dropoff-locations","title":"Q5: Monthly travel patterns for repeat customers (convex hull of dropoff locations)","text":"<p>Real-life scenario: Analyze the geographic spread of travel patterns for frequent customers to understand their mobility behavior.</p> <p>This query analyzes the monthly travel patterns of frequent customers by measuring how much geographic area they cover with their trips. For each customer who took more than five trips in a month, it calculates the size of the \"travel hull\" - the area enclosed by connecting all their dropoff locations that month. The results reveal which customers have the most expansive travel patterns, helping to identify power users who cover large geographic areas versus those who stick to smaller, local areas.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Spatial aggregation (ST_Collect/ARRAY_AGG)</li> <li>Convex hull computation (ST_ConvexHull)</li> <li>Area calculation on complex geometries</li> <li>Temporal and customer-based grouping with spatial operations</li> </ol> <pre><code>sd.sql(\"\"\"\nSELECT\n    c.c_custkey,\n    c.c_name AS customer_name,\n    DATE_TRUNC('month', t.t_pickuptime) AS pickup_month,\n    ST_Area(\n        ST_ConvexHull(ST_Collect(ST_GeomFromWKB(t.t_dropoffloc)))\n    ) AS monthly_travel_hull_area,\n    COUNT(*) as dropoff_count\nFROM trip t\nJOIN customer c\n    ON t.t_custkey = c.c_custkey\nGROUP BY c.c_custkey, c.c_name, pickup_month\nHAVING dropoff_count &gt; 5 -- Only include repeat customers\nORDER BY monthly_travel_hull_area DESC, c.c_custkey ASC\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 c_custkey \u2506    customer_name   \u2506     pickup_month    \u2506 monthly_travel_hul \u2506 dropoff_count \u2502\n\u2502   int64   \u2506        utf8        \u2506      timestamp      \u2506       l_area\u2026      \u2506     int64     \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502     25975 \u2506 Customer#000025975 \u2506 1992-02-01T00:00:00 \u2506 34941.303419053635 \u2506            10 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502     12061 \u2506 Customer#000012061 \u2506 1997-03-01T00:00:00 \u2506  34607.53871953154 \u2506            14 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502     21418 \u2506 Customer#000021418 \u2506 1993-08-01T00:00:00 \u2506  34465.32323910264 \u2506             9 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q6-zone-statistics-for-trips-within-a-50km-radius-of-the-sedona-city-center","title":"Q6: Zone statistics for trips within a 50km radius of the Sedona city center","text":"<p>Real-life scenario: Analyze trip patterns in zones within a metropolitan area around a specific city center.</p> <p>This query analyzes ride activity across all neighborhoods and zones within a 50-kilometer area around Sedona, Arizona. It identifies which zones had the most pickup activity by counting total trips that started in each region. Also, it calculates the average trip cost and duration for rides originating from each zone. The results are ranked by pickup volume, showing which neighborhoods or areas generate the most ride demand and their typical trip characteristics within the greater Sedona region.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Polygon containment check (ST_Contains) with bounding box</li> <li>Point-in-polygon spatial join (ST_Within)</li> </ol> <pre><code>sd.sql(\"\"\"\nSELECT\n    z.z_zonekey,\n    z.z_name,\n    COUNT(t.t_tripkey) AS total_pickups,\n    AVG(t.t_distance) AS avg_distance, -- Corrected from t_totalamount\n    AVG(t.t_dropofftime - t.t_pickuptime) AS avg_duration\nFROM trip t, zone z\nWHERE ST_Intersects(\n    ST_GeomFromText('POLYGON((\n        -112.2110 34.4197, -111.3110 34.4197,\n        -111.3110 35.3197, -112.2110 35.3197,\n        -112.2110 34.4197\n    ))'), -- Bounding box around Sedona\n    ST_GeomFromWKB(z.z_boundary)\n  )\n  AND ST_Within(\n    ST_GeomFromWKB(t.t_pickuploc),\n    ST_GeomFromWKB(z.z_boundary)\n  )\nGROUP BY z.z_zonekey, z.z_name\nORDER BY total_pickups DESC, z.z_zonekey ASC\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 z_zonekey \u2506      z_name     \u2506 total_pickups \u2506 avg_distance \u2506            avg_duration            \u2502\n\u2502   int64   \u2506       utf8      \u2506     int64     \u2506  decimal128  \u2506              duration              \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502     30084 \u2506 Coconino County \u2506           541 \u2506  0.000030406 \u2506 0 days 1 hours 45 mins 16.591 secs \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502     30083 \u2506 Yavapai County  \u2506           292 \u2506  0.000027157 \u2506 0 days 1 hours 36 mins 43.647 secs \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502     29488 \u2506 Gila County     \u2506            39 \u2506  0.000021282 \u2506 0 days 1 hours 16 mins 59.769 secs \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q7-detect-potential-route-detours-by-comparing-reported-vs-geometric-distances","title":"Q7: Detect potential route detours by comparing reported vs. geometric distances","text":"<p>Real-life scenario: Identify suspicious trips where the reported distance significantly exceeds the straight-line distance, potentially indicating fare manipulation.</p> <p>This query analyzes how much taxi and rideshare trips deviate from the most direct route by comparing the actual reported trip distance to the straight-line distance between pickup and dropoff points. It calculates a \"detour ratio\" that shows how much longer the actual route was compared to flying in a straight line.  For example, a ratio of 1.5 means the trip was 50% longer than the direct path. The results are sorted to show the trips with the highest detour ratios first, helping identify routes that took significant detours due to traffic, road layouts, or other factors.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Line geometry creation (ST_MakeLine)</li> <li>Length calculation (ST_Length)</li> <li>Coordinate system conversion and distance calculations</li> <li>Ratio-based filtering on geometric vs. reported measurements</li> </ol> <pre><code>sd.sql(\"\"\"\nWITH trip_lengths AS (\n    SELECT\n        t.t_tripkey,\n        t.t_distance AS reported_distance_m,\n        ST_Length(\n            ST_MakeLine(\n                ST_GeomFromWKB(t.t_pickuploc),\n                ST_GeomFromWKB(t.t_dropoffloc)\n            )\n        ) * 111111 AS line_distance_m -- Approx. meters per degree\n    FROM trip t\n)\nSELECT\n    t.t_tripkey,\n    t.reported_distance_m,\n    t.line_distance_m,\n    t.reported_distance_m / NULLIF(t.line_distance_m, 0) AS detour_ratio\nFROM trip_lengths t\nORDER BY\n    detour_ratio DESC NULLS LAST,\n    reported_distance_m DESC,\n    t_tripkey ASC\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 t_tripkey \u2506 reported_distance_m \u2506   line_distance_m  \u2506     detour_ratio     \u2502\n\u2502   int64   \u2506      decimal128     \u2506       float64      \u2506        float64       \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502   4688563 \u2506             0.00010 \u2506 11111.114941555596 \u2506 8.999996897341038e-9 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502   2380123 \u2506             0.00010 \u2506 11111.114983939786 \u2506 8.999996863009868e-9 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502   3077131 \u2506             0.00010 \u2506 11111.115027455284 \u2506 8.999996827762339e-9 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q8-count-nearby-pickups-for-each-building-within-a-500m-radius","title":"Q8: Count nearby pickups for each building within a 500m radius","text":"<p>Real-life scenario: Count how many trips start within 500 meters of each building.</p> <p>This query identifies which buildings generate the most taxi and rideshare pickup activity by counting trips that started within 500 meters of each building. It analyzes the relationship between specific buildings (like hotels, shopping centers, airports, or office buildings) and ride demand in their immediate vicinity. The results are ranked to show which buildings are the biggest trip generators, helping identify key pickup hotspots and understand how different types of buildings drive transportation demand.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Distance spatial join between points and polygons</li> <li>Aggregation on spatial join result</li> </ol> <pre><code>sd.sql(\"\"\"\nSELECT b.b_buildingkey, b.b_name, COUNT(*) AS nearby_pickup_count\nFROM trip t\nJOIN building b\nON ST_DWithin(ST_GeomFromWKB(t.t_pickuploc), ST_GeomFromWKB(b.b_boundary), 0.0045) -- ~500m\nGROUP BY b.b_buildingkey, b.b_name\nORDER BY nearby_pickup_count DESC, b.b_buildingkey ASC\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 b_buildingkey \u2506 b_name \u2506 nearby_pickup_count \u2502\n\u2502     int64     \u2506  utf8  \u2506        int64        \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502          3779 \u2506 linen  \u2506                  42 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502         19135 \u2506 misty  \u2506                  36 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502          4416 \u2506 sienna \u2506                  26 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q9-building-conflation-duplicateoverlap-detection-via-iou","title":"Q9: Building Conflation (duplicate/overlap detection via IoU)","text":"<p>Real-life scenario: Detect duplicate or overlapping building footprints in GIS datasets to identify data quality issues.</p> <p>This query identifies overlapping buildings by calculating how much their footprints intersect with each other. For every pair of buildings that touch or overlap, it measures the total area of each building and the area where they overlap, then calculates an \"Intersection over Union\" (IoU) score that ranges from 0 to 1. The results are sorted by IoU score to show the most significantly overlapping building pairs first, which could help identify data quality issues, adjacent structures, or buildings that share common areas like courtyards or parking lots.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Self-join with spatial intersection (ST_Intersects)</li> <li>Area calculations (ST_Area)</li> <li>Geometric intersection operations (ST_Intersection)</li> <li>Complex geometric ratio calculations (IoU - Intersection over Union)</li> </ol> <pre><code>sd.sql(\"\"\"\nWITH b1 AS (\n   SELECT b_buildingkey AS id, ST_GeomFromWKB(b_boundary) AS geom\n   FROM building\n),\nb2 AS (\n    SELECT b_buildingkey AS id, ST_GeomFromWKB(b_boundary) AS geom\n    FROM building\n),\npairs AS (\n    SELECT\n        b1.id AS building_1,\n        b2.id AS building_2,\n        ST_Area(b1.geom) AS area1,\n        ST_Area(b2.geom) AS area2,\n        ST_Area(ST_Intersection(b1.geom, b2.geom)) AS overlap_area\n    FROM b1\n    JOIN b2 ON b1.id &lt; b2.id AND ST_Intersects(b1.geom, b2.geom)\n)\nSELECT\n   building_1,\n   building_2,\n   area1,\n   area2,\n   overlap_area,\n   CASE\n       WHEN (area1 + area2 - overlap_area) = 0 THEN 1.0\n       ELSE overlap_area / (area1 + area2 - overlap_area)\n   END AS iou\nFROM pairs\nORDER BY iou DESC, building_1 ASC, building_2 ASC\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 building_1 \u2506 building_2 \u2506 \u2026 \u2506      overlap_area     \u2506         iou        \u2502\n\u2502    int64   \u2506    int64   \u2506   \u2506        float64        \u2506       float64      \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502       2285 \u2506      15719 \u2506 \u2026 \u2506 2.3709162946727276e-6 \u2506 0.9056816071717889 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502       7562 \u2506      18534 \u2506 \u2026 \u2506  5.855106543747764e-6 \u2506 0.8450437137796769 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502       2285 \u2506      13658 \u2506 \u2026 \u2506 1.9770693222933237e-6 \u2506  0.737899157380637 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q10-zone-statistics-for-trips-starting-within-each-zone","title":"Q10: Zone statistics for trips starting within each zone","text":"<p>Real-life scenario: Analyze trip patterns and performance metrics for each administrative zone (like city districts or neighborhoods).</p> <p>This query analyzes trip patterns across all geographic zones by calculating average trip duration, distance, and volume for rides originating from each area. It uses a left join to include all zones in the results, even those with no pickup activity, showing which neighborhoods generate longer trips on average versus shorter local rides. The results are sorted by average trip duration to identify zones where people tend to take longer journeys, which could indicate more isolated areas, have limited local amenities, or serve as departure points for longer-distance travel.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Point-in-polygon spatial join (ST_Within)</li> <li>Aggregation with multiple metrics (average duration, distance, count)</li> <li>LEFT JOIN to include zones with no trips</li> </ol> <pre><code>sd.sql(\"\"\"\nSELECT\n    z.z_zonekey,\n    z.z_name AS pickup_zone,\n    AVG(t.t_dropofftime - t.t_pickuptime) AS avg_duration,\n    AVG(t.t_distance) AS avg_distance,\n    COUNT(t.t_tripkey) AS num_trips\nFROM\n    zone z\n    LEFT JOIN trip t\n    ON ST_Within(\n        ST_GeomFromWKB(t.t_pickuploc), ST_GeomFromWKB(z.z_boundary)\n    )\nGROUP BY z.z_zonekey, z.z_name\nORDER BY avg_duration DESC NULLS LAST, z.z_zonekey ASC\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 z_zonekey \u2506   pickup_zone  \u2506            avg_duration            \u2506 avg_distance \u2506 num_trips \u2502\n\u2502   int64   \u2506      utf8      \u2506              duration              \u2506  decimal128  \u2506   int64   \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502     31558 \u2506 Benewah County \u2506 4 days 13 hours 3 mins 34.000 secs \u2506  0.002180000 \u2506         2 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502    119540 \u2506 Kreis Unna     \u2506 2 days 4 hours 52 mins 44.000 secs \u2506  0.001050000 \u2506         1 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502     59928 \u2506 Ndhiwa         \u2506 2 days 4 hours 19 mins 39.000 secs \u2506  0.001040000 \u2506         1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q11-count-trips-that-cross-between-different-zones","title":"Q11: Count trips that cross between different zones","text":"<p>Real-life scenario: Identify inter-district or inter-city trips to understand cross-boundary travel patterns.</p> <p>This query counts how many trips crossed zone boundaries by starting in one geographic zone and ending in a different zone. It identifies each trip's pickup and dropoff zones, then filters to only include trips where the pickup zone is different from the dropoff zone. The result shows the total number of inter-zone trips, helping measure how much travel occurs between different neighborhoods, districts, or areas rather than staying within the same local zone.</p> <p>Spatial query characteristics tested:</p> <ol> <li>Multiple point-in-polygon spatial joins</li> <li>Filtering based on spatial relationship results</li> </ol> <pre><code>sd.sql(\"\"\"\nSELECT COUNT(*) AS cross_zone_trip_count\nFROM\n    trip t\n    JOIN zone pickup_zone\n        ON ST_Within(\n            ST_GeomFromWKB(t.t_pickuploc),\n            ST_GeomFromWKB(pickup_zone.z_boundary)\n        )\n    JOIN zone dropoff_zone\n        ON ST_Within(\n            ST_GeomFromWKB(t.t_dropoffloc),\n            ST_GeomFromWKB(dropoff_zone.z_boundary)\n        )\nWHERE pickup_zone.z_zonekey != dropoff_zone.z_zonekey\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 cross_zone_trip_count \u2502\n\u2502         int64         \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502                176391 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"queries/#q12-find-five-nearest-buildings-to-each-trip-pickup-location-using-knn-join","title":"Q12: Find five nearest buildings to each trip pickup location using KNN join","text":"<p>Real-life scenario: Identify the closest landmarks or buildings to each trip start point for location context and navigation.</p> <p>This query finds the 5 closest buildings to each trip pickup location using spatial nearest neighbor analysis. For every trip, it identifies the five buildings that are geographically closest to where the passenger was picked up and calculates the exact distance to each of those buildings. The results show which buildings are most commonly near pickup points, helping understand the relationship between trip origins and nearby landmarks, businesses, or residential structures that might influence ride demand patterns.</p> <p>Spatial query characteristics tested:</p> <ol> <li>K-nearest neighbor (KNN) spatial join</li> <li>Distance calculations between points and polygons</li> <li>Ranking and limiting results based on spatial proximity</li> </ol> <pre><code>sd.sql(\"\"\"\nWITH trip_with_geom AS (\n    SELECT\n        t_tripkey,\n        t_pickuploc,\n        ST_GeomFromWKB(t_pickuploc) as pickup_geom\n    FROM trip\n),\nbuilding_with_geom AS (\n    SELECT\n        b_buildingkey,\n        b_name,\n        b_boundary,\n        ST_GeomFromWKB(b_boundary) as boundary_geom\n    FROM building\n)\nSELECT\n    t.t_tripkey,\n    t.t_pickuploc,\n    b.b_buildingkey,\n    b.b_name AS building_name,\n    ST_Distance(t.pickup_geom, b.boundary_geom) AS distance_to_building\nFROM trip_with_geom t\nJOIN building_with_geom b\n    ON ST_KNN(t.pickup_geom, b.boundary_geom, 5, FALSE)\nORDER BY t.t_tripkey ASC, distance_to_building ASC, b.b_buildingkey ASC\n\"\"\").show(3)\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 t_tripkey \u2506           t_pickuploc           \u2506 b_buildingkey \u2506 building_name \u2506 distance_to_buildi \u2502\n\u2502   int64   \u2506              binary             \u2506     int64     \u2506      utf8     \u2506         ng\u2026        \u2502\n\u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u256a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2561\n\u2502         1 \u2506 01010000009f3c318dd43735405930\u2026 \u2506         15870 \u2506 purple        \u2506  0.984633987957188 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502         1 \u2506 01010000009f3c318dd43735405930\u2026 \u2506          6800 \u2506 ghost         \u2506  1.205725156670704 \u2502\n\u251c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u253c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u254c\u2524\n\u2502         1 \u2506 01010000009f3c318dd43735405930\u2026 \u2506          8384 \u2506 lavender      \u2506 1.4195012994942622 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"single-node-benchmarks/","title":"SpatialBench Single Node Benchmarks","text":"<p>This page presents the SpatialBench single-node benchmark results for SedonaDB, DuckDB, and GeoPandas. The benchmark was conducted on September 22, 2025, using SpatialBench v0.1.0 pre-release (commit <code>9094be8</code> on the main branch).</p> <p>Here are the results from SpatialBench v0.1 for Queries 1\u201312 at scale factor 1 (SF1) and scale factor 10 (SF10).</p> <p> </p>"},{"location":"single-node-benchmarks/#hardware","title":"Hardware","text":"<p>This benchmark was run on an AWS EC2 <code>m7i.2xlarge</code> instance, which has 8 CPUs and 32 GB of RAM. We encourage you to try running SpatialBench on different hardware configurations and share your results with the community.</p>"},{"location":"single-node-benchmarks/#test-data","title":"Test Data","text":"<p>The datasets are generated using SpatialBench\u2019s dbgen and stored in an AWS S3 bucket in pure Parquet format. Geometry columns are encoded in Well-Known Binary (WKB) using the Parquet BINARY type. All systems read Parquet files directly from the S3 bucket. No local pre-loading is involved. Each Parquet row group is 128 MB. To better reflect real-world scenarios, large Parquet files are split into smaller ones, each around 200\u2013300 MB in size.</p> <p>We provide public datasets for Scale Factor 1 and 10 in the <code>us-west-2</code> region. You can access them here:</p> Scale Factor = 1Scale Factor = 10 <pre><code>s3://wherobots-examples/data/spatialbench/SpatialBench_sf1/building/\ns3://wherobots-examples/data/spatialbench/SpatialBench_sf1/customer/\ns3://wherobots-examples/data/spatialbench/SpatialBench_sf1/driver/\ns3://wherobots-examples/data/spatialbench/SpatialBench_sf1/trip/\ns3://wherobots-examples/data/spatialbench/SpatialBench_sf1/vehicle/\ns3://wherobots-examples/data/spatialbench/SpatialBench_sf1/zone/\n</code></pre> <pre><code>s3://wherobots-examples/data/spatialbench/SpatialBench_sf10/building/\ns3://wherobots-examples/data/spatialbench/SpatialBench_sf10/customer/\ns3://wherobots-examples/data/spatialbench/SpatialBench_sf10/driver/\ns3://wherobots-examples/data/spatialbench/SpatialBench_sf10/trip/\ns3://wherobots-examples/data/spatialbench/SpatialBench_sf10/vehicle/\ns3://wherobots-examples/data/spatialbench/SpatialBench_sf10/zone/\n</code></pre>"},{"location":"single-node-benchmarks/#software","title":"Software","text":"<p>The following software versions were used in this benchmark:</p> <ul> <li>GeoPandas: 1.1.1</li> <li>Shapely: 2.1.1</li> <li>NumPy: 2.3.3</li> <li>DuckDB: 1.4.0</li> <li>SedonaDB: 0.1.0</li> </ul> <p>This benchmark report specifies software versions to make it easier to track performance improvements over time. We use the default settings of all software unless otherwise noted. For DuckDB, we explicitly set <code>enable_external_file_cache</code> to <code>false</code> to focus on the cold start queries runtime, consistent with the other engines.</p> <p>The reported runtimes include the entire query execution for each engine, including data loading. We used <code>COUNT</code> on every query result to trigger full execution, but did not write outputs to external files in order to avoid introducing additional overhead from data writing. A query timeout of <code>1200</code> seconds was applied.</p> <p>Since GeoPandas executes in a single thread and lacks a query optimizer, any parallelization or optimization must be implemented manually. For this benchmark, we did a straightforward Python implementation that mirrors the SQL queries run on other engines. If you are a GeoPandas expert, we would be happy to collaborate on a more optimized or parallelized version.</p>"},{"location":"single-node-benchmarks/#result-analysis","title":"Result analysis","text":""},{"location":"single-node-benchmarks/#spatial-filters-and-basic-operations-q1q6","title":"Spatial filters and basic operations (Q1\u2013Q6)","text":"<p>DuckDB and SedonaDB achieve similar low-latency performance at both SF 1 and SF 10, while GeoPandas struggles to keep up at larger scales. The main reasons are the lack of a query optimizer to choose efficient execution strategies and the absence of multi-core parallelism. By contrast, DuckDB and SedonaDB leverage columnar data layouts, vectorized execution, multi-core parallelism, and query optimization to achieve strong performance. However, SedonaDB faces challenges with spatial aggregation (Q5), where DuckDB performs significantly better. This is a known issue in SedonaDB and is planned for improvement.</p>"},{"location":"single-node-benchmarks/#geometric-computations-q7q9","title":"Geometric computations (Q7\u2013Q9)","text":"<p>SedonaDB is especially effective on intersection/IoU (Q9), showing substantial efficiency improvements. These queries focus on geometric operations like area calculations, distance computations, and spatial intersections.</p>"},{"location":"single-node-benchmarks/#complex-spatial-joins-and-aggregations-q10q11","title":"Complex spatial joins and aggregations (Q10\u2013Q11)","text":"<p>SedonaDB consistently delivers strong results on heavier joins, particularly Q10 and Q11, aided by its adaptive spatial join strategy that picks the best algorithm per partition based on spatial statistics. DuckDB handles some join queries well but encounters scaling issues in certain cases, while GeoPandas completes SF 1 but not SF 10.</p>"},{"location":"single-node-benchmarks/#nearest-neighbor-joins-q12","title":"Nearest-neighbor joins (Q12)","text":"<p>SedonaDB completes KNN joins at both SF 1 and SF 10, thanks to its native operator and optimized algorithm. In contrast, DuckDB and GeoPandas currently lack built-in KNN join support. For these engines, we had to implement additional code manually, which proved less efficient. Adding native KNN capabilities in the future would likely help both engines close this gap.</p>"},{"location":"single-node-benchmarks/#overall","title":"Overall","text":"<p>SedonaDB demonstrates balanced performance across all query types and scales effectively to SF 10. DuckDB excels at spatial filters and some geometric operations but faces challenges with complex joins and KNN queries. GeoPandas, while popular in the Python ecosystem, requires manual optimization and parallelization to handle larger datasets effectively.</p>"},{"location":"single-node-benchmarks/#benchmark-code","title":"Benchmark code","text":"<p>You can access and run the benchmark code in the sedona-spatialbench GitHub repository.</p> <p>You can generate datasets and run benchmarks both locally and in cloud environments.</p> <p>The repository has an issue tracker where you can file bug reports or suggest code improvements.</p>"},{"location":"single-node-benchmarks/#raw-benchmark-performance-numbers","title":"Raw Benchmark Performance Numbers","text":"<p>The following tables present the recorded benchmark results in full detail.</p> Scale Factor = 1Scale Factor = 10 Query SedonaDB DuckDB GeoPandas q1 0.66 0.96 12.78 q2 8.07 9.95 20.74 q3 0.80 1.17 13.59 q4 8.41 9.83 25.24 q5 5.10 1.80 47.08 q6 8.59 9.36 24.43 q7 1.66 1.82 137.00 q8 1.10 1.08 16.08 q9 0.23 50.15 0.28 q10 18.79 207.84 46.13 q11 32.98 TIMEOUT 51.01 q12 14.55 ERROR TIMEOUT Query SedonaDB DuckDB GeoPandas q1 3.04 4.58 ERROR q2 8.89 8.26 ERROR q3 4.09 5.17 TIMEOUT q4 7.52 8.51 ERROR q5 50.81 14.40 ERROR q6 9.11 10.67 ERROR q7 14.44 14.03 ERROR q8 7.24 7.57 TIMEOUT q9 0.38 942.98 0.49 q10 42.02 ERROR ERROR q11 97.52 ERROR ERROR q12 145.66 ERROR TIMEOUT"},{"location":"single-node-benchmarks/#future-work","title":"Future work","text":"<p>We plan to include additional engines and databases in future work, such as:</p> <ul> <li><code>dask-geopandas</code> for single-node parallelism across cores</li> <li>An R geospatial engine</li> </ul> <p>If you're an expert in any of these technologies, we welcome you to take on this project or reach out to us about collaborating.</p> <p>For clarity and simplicity, compute engines designed for multi-node environments are intentionally excluded from these single-node results. Likewise, transactional databases such as PostGIS execute queries in fundamentally different ways from pure Python engines (e.g., GeoPandas) or analytical engines (e.g., SedonaDB, DuckDB). Since SpatialBench is primarily focused on analytical workloads, these systems are not included in the current study.</p> <p>The overarching goal of the SpatialBench initiative is to provide the spatial community with a reliable set of benchmarks and to help accelerate the development of better tooling for users.</p>"}]}